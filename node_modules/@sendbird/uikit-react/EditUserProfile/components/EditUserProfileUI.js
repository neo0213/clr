import React__default, { useRef, useContext, useState } from 'react';
import { useEditUserProfileContext } from '../context.js';
import { M as Modal } from '../../chunks/bundle-5JvP07dI.js';
import { L as LocalizationContext } from '../../chunks/bundle-Xly_X4hP.js';
import { useSendbirdStateContext } from '../../useSendbirdStateContext.js';
import Input, { InputLabel } from '../../ui/Input.js';
import { A as Avatar } from '../../chunks/bundle-Tep20T57.js';
import Icon, { IconTypes } from '../../ui/Icon.js';
import '../../chunks/bundle-Y6TqPszM.js';
import { L as Label, a as LabelTypography, b as LabelColors } from '../../chunks/bundle-0IelBspE.js';
import { ButtonTypes } from '../../ui/Button.js';
import TextButton from '../../ui/TextButton.js';
import { n as noop } from '../../chunks/bundle-JhG5BHdE.js';
import { U as USER_ACTIONS } from '../../chunks/bundle-IeIHBN9i.js';
import 'react-dom';
import '../../chunks/bundle-Mn36ivpf.js';
import '../../ui/IconButton.js';
import '../../chunks/bundle-JuKER7D_.js';
import '../../chunks/bundle-xgxXEKxk.js';
import '../../withSendbird.js';
import '../../ui/ImageRenderer.js';
import '../../chunks/bundle-8VA5hO1c.js';
import '../../chunks/bundle-2AUp3oeN.js';
import '../../chunks/bundle-LhtrqZSE.js';

function EditUserProfileUI() {
    var _a, _b, _c, _d, _e, _f, _g;
    var editProfileProps = useEditUserProfileContext();
    var store = useSendbirdStateContext();
    var hiddenInputRef = useRef(null);
    var inputRef = useRef(null);
    var formRef = useRef(null);
    var stringSet = useContext(LocalizationContext).stringSet;
    var _h = useState(null), currentImg = _h[0], setCurrentImg = _h[1];
    var _j = useState(null), newFile = _j[0], setNewFile = _j[1];
    var onEditProfile = editProfileProps.onEditProfile, onCancel = editProfileProps.onCancel, onThemeChange = editProfileProps.onThemeChange;
    var theme = ((_a = store === null || store === void 0 ? void 0 : store.config) === null || _a === void 0 ? void 0 : _a.theme) || 'light';
    var changeTheme = ((_b = store === null || store === void 0 ? void 0 : store.config) === null || _b === void 0 ? void 0 : _b.setCurrentTheme) || noop;
    var user = (_d = (_c = store === null || store === void 0 ? void 0 : store.stores) === null || _c === void 0 ? void 0 : _c.userStore) === null || _d === void 0 ? void 0 : _d.user;
    var sdk = (_f = (_e = store === null || store === void 0 ? void 0 : store.stores) === null || _e === void 0 ? void 0 : _e.sdkStore) === null || _f === void 0 ? void 0 : _f.sdk;
    var userDispatcher = (_g = store === null || store === void 0 ? void 0 : store.dispatchers) === null || _g === void 0 ? void 0 : _g.userDispatcher;
    return (React__default.createElement(Modal, { titleText: stringSet.EDIT_PROFILE__TITLE, submitText: stringSet.BUTTON__SAVE, type: ButtonTypes.PRIMARY, onCancel: onCancel, isFullScreenOnMobile: true, onSubmit: function () {
            var _a;
            if ((user === null || user === void 0 ? void 0 : user.nickname) !== '' && !inputRef.current.value) {
                if (formRef.current.reportValidity) { // might not work in explorer
                    formRef.current.reportValidity();
                }
                return;
            }
            sdk === null || sdk === void 0 ? void 0 : sdk.updateCurrentUserInfo({
                nickname: (_a = inputRef === null || inputRef === void 0 ? void 0 : inputRef.current) === null || _a === void 0 ? void 0 : _a.value,
                profileImage: newFile,
            }).then(function (updatedUser) {
                userDispatcher({ type: USER_ACTIONS.UPDATE_USER_INFO, payload: updatedUser });
                if (onEditProfile && typeof onEditProfile === 'function') {
                    onEditProfile(updatedUser);
                }
            });
        } },
        React__default.createElement("form", { className: "sendbird-edit-user-profile", ref: formRef, onSubmit: function (e) { e.preventDefault(); } },
            React__default.createElement("section", { className: "sendbird-edit-user-profile__img" },
                React__default.createElement(InputLabel, null, stringSet.EDIT_PROFILE__IMAGE_LABEL),
                React__default.createElement("div", { className: "sendbird-edit-user-profile__img__avatar" },
                    React__default.createElement(Avatar, { width: "80px", height: "80px", src: currentImg || (user === null || user === void 0 ? void 0 : user.profileUrl) })),
                React__default.createElement("input", { ref: hiddenInputRef, type: "file", accept: "image/gif, image/jpeg, image/png", style: { display: 'none' }, onChange: function (e) {
                        setCurrentImg(URL.createObjectURL(e.target.files[0]));
                        setNewFile(e.target.files[0]);
                        hiddenInputRef.current.value = '';
                    } }),
                React__default.createElement(TextButton, { className: "sendbird-edit-user-profile__img__avatar-button", disableUnderline: true, onClick: function () { return hiddenInputRef.current.click(); } },
                    React__default.createElement(Label, { type: LabelTypography.BUTTON_1, color: LabelColors.PRIMARY }, stringSet.EDIT_PROFILE__IMAGE_UPLOAD))),
            React__default.createElement("section", { className: "sendbird-edit-user-profile__name" },
                React__default.createElement(InputLabel, null, stringSet.EDIT_PROFILE__NICKNAME_LABEL),
                React__default.createElement(Input, { required: (user === null || user === void 0 ? void 0 : user.nickname) !== '', name: "sendbird-edit-user-profile__name__input", ref: inputRef, value: user === null || user === void 0 ? void 0 : user.nickname, placeHolder: stringSet.EDIT_PROFILE__NICKNAME_PLACEHOLDER })),
            React__default.createElement("section", { className: "sendbird-edit-user-profile__userid" },
                React__default.createElement(InputLabel, null, stringSet.EDIT_PROFILE__USERID_LABEL),
                React__default.createElement(Input, { disabled: true, name: "sendbird-edit-user-profile__userid__input", value: user === null || user === void 0 ? void 0 : user.userId })),
            React__default.createElement("section", { className: "sendbird-edit-user-profile__theme" },
                React__default.createElement(InputLabel, null, stringSet.EDIT_PROFILE__THEME_LABEL),
                React__default.createElement("div", { className: "sendbird-edit-user-profile__theme__theme-icon" }, theme === 'dark'
                    ? (React__default.createElement(Icon, { onClick: function () {
                            changeTheme('light');
                            onThemeChange === null || onThemeChange === void 0 ? void 0 : onThemeChange('light');
                            // if (onThemeChange && typeof onThemeChange === 'function') {
                            //   onThemeChange('light');
                            // }
                        }, type: IconTypes.TOGGLE_ON, width: 44, height: 24 }))
                    : (React__default.createElement(Icon, { onClick: function () {
                            changeTheme('dark');
                            onThemeChange === null || onThemeChange === void 0 ? void 0 : onThemeChange('dark');
                            // if (onThemeChange && typeof onThemeChange === 'function') {
                            //   onThemeChange('dark');
                            // }
                        }, type: IconTypes.TOGGLE_OFF, width: 44, height: 24 })))))));
}

export { EditUserProfileUI as default };
//# sourceMappingURL=EditUserProfileUI.js.map
