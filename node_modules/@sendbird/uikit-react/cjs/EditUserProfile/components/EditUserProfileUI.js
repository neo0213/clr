'use strict';

var React = require('react');
var EditUserProfile_context = require('../context.js');
var ui_Modal = require('../../chunks/bundle-JragPpHy.js');
var LocalizationContext = require('../../chunks/bundle-ZurhBjw4.js');
var useSendbirdStateContext = require('../../useSendbirdStateContext.js');
var ui_Input = require('../../ui/Input.js');
var ui_Avatar = require('../../chunks/bundle-vSdu8rrq.js');
var ui_Icon = require('../../ui/Icon.js');
require('../../chunks/bundle-QH7iLrPR.js');
var ui_Label = require('../../chunks/bundle-0MHADZvF.js');
var ui_Button = require('../../ui/Button.js');
var ui_TextButton = require('../../ui/TextButton.js');
var utils = require('../../chunks/bundle-Pe-j2f1D.js');
var actionTypes = require('../../chunks/bundle-vWlSj3_G.js');
require('react-dom');
require('../../chunks/bundle-vWUmeH2R.js');
require('../../ui/IconButton.js');
require('../../chunks/bundle-v8bBiJ_c.js');
require('../../chunks/bundle-cV7uGK08.js');
require('../../withSendbird.js');
require('../../ui/ImageRenderer.js');
require('../../chunks/bundle-NYFm08XH.js');
require('../../chunks/bundle-MeuNh9Q9.js');
require('../../chunks/bundle-yTYZiuXi.js');

function EditUserProfileUI() {
    var _a, _b, _c, _d, _e, _f, _g;
    var editProfileProps = EditUserProfile_context.useEditUserProfileContext();
    var store = useSendbirdStateContext.useSendbirdStateContext();
    var hiddenInputRef = React.useRef(null);
    var inputRef = React.useRef(null);
    var formRef = React.useRef(null);
    var stringSet = React.useContext(LocalizationContext.LocalizationContext).stringSet;
    var _h = React.useState(null), currentImg = _h[0], setCurrentImg = _h[1];
    var _j = React.useState(null), newFile = _j[0], setNewFile = _j[1];
    var onEditProfile = editProfileProps.onEditProfile, onCancel = editProfileProps.onCancel, onThemeChange = editProfileProps.onThemeChange;
    var theme = ((_a = store === null || store === void 0 ? void 0 : store.config) === null || _a === void 0 ? void 0 : _a.theme) || 'light';
    var changeTheme = ((_b = store === null || store === void 0 ? void 0 : store.config) === null || _b === void 0 ? void 0 : _b.setCurrentTheme) || utils.noop;
    var user = (_d = (_c = store === null || store === void 0 ? void 0 : store.stores) === null || _c === void 0 ? void 0 : _c.userStore) === null || _d === void 0 ? void 0 : _d.user;
    var sdk = (_f = (_e = store === null || store === void 0 ? void 0 : store.stores) === null || _e === void 0 ? void 0 : _e.sdkStore) === null || _f === void 0 ? void 0 : _f.sdk;
    var userDispatcher = (_g = store === null || store === void 0 ? void 0 : store.dispatchers) === null || _g === void 0 ? void 0 : _g.userDispatcher;
    return (React.createElement(ui_Modal.Modal, { titleText: stringSet.EDIT_PROFILE__TITLE, submitText: stringSet.BUTTON__SAVE, type: ui_Button.ButtonTypes.PRIMARY, onCancel: onCancel, isFullScreenOnMobile: true, onSubmit: function () {
            var _a;
            if ((user === null || user === void 0 ? void 0 : user.nickname) !== '' && !inputRef.current.value) {
                if (formRef.current.reportValidity) { // might not work in explorer
                    formRef.current.reportValidity();
                }
                return;
            }
            sdk === null || sdk === void 0 ? void 0 : sdk.updateCurrentUserInfo({
                nickname: (_a = inputRef === null || inputRef === void 0 ? void 0 : inputRef.current) === null || _a === void 0 ? void 0 : _a.value,
                profileImage: newFile,
            }).then(function (updatedUser) {
                userDispatcher({ type: actionTypes.USER_ACTIONS.UPDATE_USER_INFO, payload: updatedUser });
                if (onEditProfile && typeof onEditProfile === 'function') {
                    onEditProfile(updatedUser);
                }
            });
        } },
        React.createElement("form", { className: "sendbird-edit-user-profile", ref: formRef, onSubmit: function (e) { e.preventDefault(); } },
            React.createElement("section", { className: "sendbird-edit-user-profile__img" },
                React.createElement(ui_Input.InputLabel, null, stringSet.EDIT_PROFILE__IMAGE_LABEL),
                React.createElement("div", { className: "sendbird-edit-user-profile__img__avatar" },
                    React.createElement(ui_Avatar.Avatar, { width: "80px", height: "80px", src: currentImg || (user === null || user === void 0 ? void 0 : user.profileUrl) })),
                React.createElement("input", { ref: hiddenInputRef, type: "file", accept: "image/gif, image/jpeg, image/png", style: { display: 'none' }, onChange: function (e) {
                        setCurrentImg(URL.createObjectURL(e.target.files[0]));
                        setNewFile(e.target.files[0]);
                        hiddenInputRef.current.value = '';
                    } }),
                React.createElement(ui_TextButton, { className: "sendbird-edit-user-profile__img__avatar-button", disableUnderline: true, onClick: function () { return hiddenInputRef.current.click(); } },
                    React.createElement(ui_Label.Label, { type: ui_Label.LabelTypography.BUTTON_1, color: ui_Label.LabelColors.PRIMARY }, stringSet.EDIT_PROFILE__IMAGE_UPLOAD))),
            React.createElement("section", { className: "sendbird-edit-user-profile__name" },
                React.createElement(ui_Input.InputLabel, null, stringSet.EDIT_PROFILE__NICKNAME_LABEL),
                React.createElement(ui_Input.default, { required: (user === null || user === void 0 ? void 0 : user.nickname) !== '', name: "sendbird-edit-user-profile__name__input", ref: inputRef, value: user === null || user === void 0 ? void 0 : user.nickname, placeHolder: stringSet.EDIT_PROFILE__NICKNAME_PLACEHOLDER })),
            React.createElement("section", { className: "sendbird-edit-user-profile__userid" },
                React.createElement(ui_Input.InputLabel, null, stringSet.EDIT_PROFILE__USERID_LABEL),
                React.createElement(ui_Input.default, { disabled: true, name: "sendbird-edit-user-profile__userid__input", value: user === null || user === void 0 ? void 0 : user.userId })),
            React.createElement("section", { className: "sendbird-edit-user-profile__theme" },
                React.createElement(ui_Input.InputLabel, null, stringSet.EDIT_PROFILE__THEME_LABEL),
                React.createElement("div", { className: "sendbird-edit-user-profile__theme__theme-icon" }, theme === 'dark'
                    ? (React.createElement(ui_Icon.default, { onClick: function () {
                            changeTheme('light');
                            onThemeChange === null || onThemeChange === void 0 ? void 0 : onThemeChange('light');
                            // if (onThemeChange && typeof onThemeChange === 'function') {
                            //   onThemeChange('light');
                            // }
                        }, type: ui_Icon.IconTypes.TOGGLE_ON, width: 44, height: 24 }))
                    : (React.createElement(ui_Icon.default, { onClick: function () {
                            changeTheme('dark');
                            onThemeChange === null || onThemeChange === void 0 ? void 0 : onThemeChange('dark');
                            // if (onThemeChange && typeof onThemeChange === 'function') {
                            //   onThemeChange('dark');
                            // }
                        }, type: ui_Icon.IconTypes.TOGGLE_OFF, width: 44, height: 24 })))))));
}

module.exports = EditUserProfileUI;
//# sourceMappingURL=EditUserProfileUI.js.map
