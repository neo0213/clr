import { useEffect, useLayoutEffect, useRef } from 'react';
import { GroupChannelHandler } from '@sendbird/chat/groupChannel';
import { useUniqId } from './useUniqId.js';
export const useGroupChannelHandler = (sdk, hookHandler, handlerId) => {
    const id = useUniqId();
    const internalHandlerId = handlerId !== null && handlerId !== void 0 ? handlerId : id;
    const handlerRef = useRef(hookHandler);
    useLayoutEffect(() => {
        handlerRef.current = hookHandler;
    });
    useEffect(() => {
        const handlerMapper = (handler) => {
            const handlerKeys = Object.keys(handler);
            handlerKeys.forEach((key) => {
                // @ts-ignore
                handler[key] = (...args) => { var _a, _b; return (_b = (_a = handlerRef.current) === null || _a === void 0 ? void 0 : _a[key]) === null || _b === void 0 ? void 0 : _b.call(_a, ...args); };
            });
            return handler;
        };
        sdk.groupChannel.addGroupChannelHandler(internalHandlerId, handlerMapper(new GroupChannelHandler()));
        return () => {
            sdk.groupChannel.removeGroupChannelHandler(internalHandlerId);
        };
    }, [sdk, internalHandlerId]);
};
